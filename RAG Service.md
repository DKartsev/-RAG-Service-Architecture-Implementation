## üéØ –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

### –ß—Ç–æ —Ç–∞–∫–æ–µ RAG?
**Retrieval-Augmented Generation (RAG)** ‚Äî —ç—Ç–æ –ø–æ–¥—Ö–æ–¥ –∫ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:
- **Retrieval** (–ø–æ–∏—Å–∫) ‚Äî –Ω–∞—Ö–æ–¥–∏—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π
- **Augmented** (—É—Å–∏–ª–µ–Ω–∏–µ) ‚Äî –¥–æ–ø–æ–ª–Ω—è–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–ª—è LLM
- **Generation** (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è) ‚Äî —Å–æ–∑–¥–∞–µ—Ç –æ—Ç–≤–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏

### –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RAG –ø–æ–¥—Ö–æ–¥–∞
- ‚úÖ **–¢–æ—á–Ω–æ—Å—Ç—å** ‚Äî –æ—Ç–≤–µ—Ç—ã –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–≤ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ "–∏–∑ –≥–æ–ª–æ–≤—ã")
- ‚úÖ **–ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å** ‚Äî –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∞—è (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π)
- ‚úÖ **–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å** ‚Äî –º–æ–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
- ‚úÖ **–ö–æ–Ω—Ç—Ä–æ–ª—å** ‚Äî –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –∑–Ω–∞–Ω–∏—è–º–∏ —Å–∏—Å—Ç–µ–º—ã

*–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: —ç—Ç–æ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ RAG –ø–æ–¥—Ö–æ–¥–∞ –≤ —Ü–µ–ª–æ–º, –∞ –Ω–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è*

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```mermaid
graph TB
    A[üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å] --> B[üì± Telegram Bot]
    B --> C[üîç RAG Service]
    C --> D[üóÑÔ∏è Supabase Database]
    C --> E[ü§ñ OpenAI GPT]
    D --> F[üìä Monitoring]
    E --> F
    C --> G[üíæ In-Memory Cache]
```

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

1. **Telegram Bot** ‚Äî –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. **RAG Service** ‚Äî —è–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã
3. **Supabase** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º –ø–æ–∏—Å–∫–æ–º
4. **OpenAI GPT** ‚Äî –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–æ–≤
5. **In-Memory Cache** ‚Äî –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
6. **Monitoring** ‚Äî –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏

---

## üîß –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### 1. Telegram Bot Service
```typescript
// –†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ packages/backend/src/services/telegram.ts
class TelegramService {
  async handleMessage(message: any) {
    if (message) {
      console.log('üìù –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è:', message.text);
      if (telegramService) {
        await telegramService.handleMessage(message as any);
      } else {
        console.log('‚ö†Ô∏è Telegram —Å–µ—Ä–≤–∏—Å –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω');
      }
    }
  }
}
```

**–§—É–Ω–∫—Ü–∏–∏:**
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ webhook
- –û–±—Ä–∞–±–æ—Ç–∫–∞ callback queries
- –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç–≤–µ—Ç–æ–≤ —á–µ—Ä–µ–∑ Telegram API
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ TELEGRAM_ENABLED=1

### 2. RAG Service (–Ø–¥—Ä–æ —Å–∏—Å—Ç–µ–º—ã)
```typescript
// –†–µ–∞–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–∑ packages/backend/src/services/supabaseRAGService.ts
class SupabaseRAGService {
  private searchCache: Map<string, { results: SearchResult[], timestamp: number }>;
  private readonly CACHE_TTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç

  async query(query: RAGQuery): Promise<RAGResponse> {
    // 1. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (–≤ –ø–∞–º—è—Ç–∏, –Ω–µ Redis)
    const cacheKey = this.createCacheKey(query.question, topK, minSimilarity);
    const cached = this.searchCache.get(cacheKey);
    if (cached && !this.isCacheExpired(cached)) {
      return cached.results;
    }
    
    // 2. –°–æ–∑–¥–∞–Ω–∏–µ embedding
    const queryEmbedding = await this.createEmbedding(query.question);
    
    // 3. RPC –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
    const searchResults = await this.searchSimilarChunks(queryEmbedding, topK, minSimilarity);
    
// 4. MMR –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
// Œª=0.75 –æ–∑–Ω–∞—á–∞–µ—Ç: 75% –≤–µ—Å–∞ –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å, 25% –Ω–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
// –ó–∞—á–µ–º: –∏–∑–±–µ–≥–∞–µ—Ç –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö —á–∞–Ω–∫–æ–≤, —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
const mmrResults = this.mmrRerankImproved(searchResults, topK, 0.75);
    
    // 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
    const answer = await this.generateAnswer(query.question, mmrResults);
    
    // 6. –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏
    this.searchCache.set(cacheKey, { results: answer, timestamp: Date.now() });
    
    return answer;
  }
}
```

### 3. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
```sql
-- –†–µ–∞–ª—å–Ω–∞—è RPC —Ñ—É–Ω–∫—Ü–∏—è –∏–∑ migrations/002_rag_improvements.sql
CREATE OR REPLACE FUNCTION public.rag_hybrid_search(
  q_vec vector(1536),
  q_text text,
  k int DEFAULT 8,
  min_sim float DEFAULT 0.5
) RETURNS TABLE (
  id uuid,
  article_id uuid,
  chunk_index int,
  chunk_text text,
  cos_sim float,
  ts_rank_score float,
  hybrid_score float
) AS $$
  WITH vec AS (
    -- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (70% –≤–µ—Å–∞)
    SELECT id, article_id, chunk_index, chunk_text,
      1 - (embedding_vec <=> q_vec) AS cos_sim
    FROM kb_chunks
    WHERE embedding_vec IS NOT NULL
    ORDER BY embedding_vec <=> q_vec
    LIMIT GREATEST(k*4, 32)
  ),
  txt AS (
    -- –¢–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (30% –≤–µ—Å–∞)
    SELECT id, ts_rank_cd(content_tsv, plainto_tsquery('simple', q_text)) AS ts_rank_score
    FROM kb_chunks
    WHERE content_tsv @@ plainto_tsquery('simple', q_text)
  ),
  joined AS (
    -- –ì–∏–±—Ä–∏–¥–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞
    SELECT v.*, t.ts_rank_score,
      (0.7 * v.cos_sim) + (0.3 * COALESCE(t.ts_rank_score,0)) AS hybrid_score
    FROM vec v LEFT JOIN txt t USING (id)
  )
  SELECT * FROM joined
  WHERE cos_sim >= min_sim
  ORDER BY hybrid_score DESC
  LIMIT k;
$$;
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞

---

## üîÑ –ü–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –ü–æ—à–∞–≥–æ–≤—ã–π –ø—Ä–æ—Ü–µ—Å—Å

```mermaid
sequenceDiagram
    participant U as üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
    participant T as üì± Telegram Bot
    participant R as üîç RAG Service
    participant C as üíæ Cache
    participant D as üóÑÔ∏è Database
    participant O as ü§ñ OpenAI

    U->>T: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
    T->>R: –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
    R->>C: –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫—ç—à
    alt –ö—ç—à –Ω–∞–π–¥–µ–Ω
        C->>R: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    else –ö—ç—à –Ω–µ –Ω–∞–π–¥–µ–Ω
        R->>O: –°–æ–∑–¥–∞–µ—Ç embedding
        O->>R: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ–∫—Ç–æ—Ä
        R->>D: RPC –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
        D->>R: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
        R->>R: MMR –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ
        R->>O: –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç
        O->>R: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç
        R->>C: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ –∫—ç—à
    end
    R->>T: –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    T->>U: –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ç–≤–µ—Ç
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –∫–æ–¥

```typescript
// 1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞
const question = "–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤?";

// 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫—ç—à–∞
const cacheKey = createHash(question + topK + minSimilarity);
const cached = searchCache.get(cacheKey);
if (cached && !isExpired(cached)) {
  return cached.results;
}

// 3. –°–æ–∑–¥–∞–Ω–∏–µ embedding
const queryEmbedding = await createEmbedding(question);
const normalizedQuery = l2Normalize(queryEmbedding);

// 4. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫
const { data: searchResults } = await supabase.rpc('rag_hybrid_search', {
  q_vec: normalizedQuery,
  q_text: question,
  k: topK,
  min_sim: minSimilarity
});

// 5. MMR –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ)
// Œª=0.75 –æ–∑–Ω–∞—á–∞–µ—Ç: 75% –≤–µ—Å–∞ –Ω–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å, 25% –Ω–∞ —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ
// –ó–∞—á–µ–º: –∏–∑–±–µ–≥–∞–µ—Ç –æ–¥–Ω–æ—Ç–∏–ø–Ω—ã—Ö —á–∞–Ω–∫–æ–≤, —É–ª—É—á—à–∞–µ—Ç –∫–∞—á–µ—Å—Ç–≤–æ –æ—Ç–≤–µ—Ç–æ–≤
const mmrResults = this.mmrRerankImproved(searchResults, topK, 0.75);

// 6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
const prompt = `–ù–∞ –æ—Å–Ω–æ–≤–µ —Å–ª–µ–¥—É—é—â–µ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ—Ç–≤–µ—Ç—å –Ω–∞ –≤–æ–ø—Ä–æ—Å: "${question}"
–ö–æ–Ω—Ç–µ–∫—Å—Ç: ${mmrResults.map(r => r.content).join('\n\n')}`;

const response = await openai.chat.completions.create({
  model: 'gpt-4o-mini',
  messages: [{ role: 'user', content: prompt }],
  temperature: 0.1
});

// 7. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –∫—ç—à
searchCache.set(cacheKey, { results: response, timestamp: Date.now() });
```

---

## üóÑÔ∏è –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ —Ç–∞–±–ª–∏—Ü

```sql
-- –û—Å–Ω–æ–≤–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å —á–∞–Ω–∫–∞–º–∏
CREATE TABLE kb_chunks (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  article_id uuid NOT NULL,
  chunk_index int NOT NULL,
  chunk_text text NOT NULL,
  embedding jsonb,                    -- –°—Ç–∞—Ä—ã–π —Ñ–æ—Ä–º–∞—Ç
  embedding_vec vector(1536),         -- –ù–æ–≤—ã–π –≤–µ–∫—Ç–æ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
  content_tsv tsvector,               -- –î–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
  created_at timestamp DEFAULT now()
);

-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤
CREATE TABLE rag_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  question_hash text NOT NULL,
  question_text text,
  top_k int,
  min_similarity float,
  results_count int,
  search_time_ms int,
  llm_time_ms int,
  total_time_ms int,
  model_used text,
  confidence float,
  created_at timestamp DEFAULT now()
);
```

### –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

```sql
-- –í–µ–∫—Ç–æ—Ä–Ω—ã–π –ø–æ–∏—Å–∫ (IVFFlat)
CREATE INDEX kb_chunks_vec_ivfflat
  ON kb_chunks USING ivfflat (embedding_vec vector_cosine_ops)
  WITH (lists = 100);

-- –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (GIN)
CREATE INDEX kb_chunks_tsv_idx
  ON kb_chunks USING gin(content_tsv);

-- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
CREATE INDEX rag_logs_question_hash_idx ON rag_logs(question_hash);
CREATE INDEX rag_logs_created_at_idx ON rag_logs(created_at);
```

---

## üåê API Endpoints

### –û—Å–Ω–æ–≤–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã

```typescript
// POST /api/rag/query
{
  "question": "–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤?",
  "options": {
    "topK": 5,
    "minSimilarity": 0.5
  }
}

// –û—Ç–≤–µ—Ç
{
  "answer": "–î–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏...",
  "sources": [
    {
      "id": "uuid",
      "title": "–ß–∞–Ω–∫ 1",
      "content": "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–ª–∏ API...",
      "score": 0.85,
      "metadata": {
        "similarity": 0.92,
        "hybridScore": 0.85
      }
    }
  ],
  "confidence": 0.85,
  "searchTime": 124,
  "processingTime": 2234,
  "metadata": {
    "queryRephrased": "–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤?",
    "searchStrategy": "hybrid",
    "modelUsed": "gpt-4o-mini"
  }
}
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ endpoints

```typescript
// GET /api/rag/stats
// –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∑–∞ –ø–µ—Ä–∏–æ–¥

// POST /api/rag/health
// –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

// GET /api/rag/monitoring
// –î–∞–Ω–Ω—ã–µ –¥–ª—è –¥–∞—à–±–æ—Ä–¥–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
```

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°–æ–±–∏—Ä–∞–µ–º—ã–µ –º–µ—Ç—Ä–∏–∫–∏

```typescript
// –†–µ–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏–∑ packages/backend/src/services/supabaseRAGService.ts
interface RAGMetrics {
  // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å–æ–±–∏—Ä–∞—é—Ç—Å—è)
  searchTime: number;        // –í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ (–º—Å)
  llmTime: number;          // –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (–º—Å) 
  totalTime: number;        // –û–±—â–µ–µ –≤—Ä–µ–º—è (–º—Å)
  
  // –ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—Å–æ–±–∏—Ä–∞—é—Ç—Å—è)
  resultsCount: number;     // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
  confidence: number;       // –£—Ä–æ–≤–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ (0-1)
  
  // –°–∏—Å—Ç–µ–º–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ (—á–∞—Å—Ç–∏—á–Ω–æ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è)
  modelUsed: string;        // –ò—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –º–æ–¥–µ–ª—å
  fallbackUsed: boolean;    // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –ª–∏ fallback
  queryProcessed: string;   // –û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å
  searchStrategy: string;   // –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–æ–∏—Å–∫–∞
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `rag_logs` —Ç–∞–±–ª–∏—Ü–µ

### –î–∞—à–±–æ—Ä–¥ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

```sql
-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
CREATE VIEW rag_monitoring AS
SELECT 
  DATE_TRUNC('hour', created_at) as hour,
  COUNT(*) as queries,
  ROUND(AVG(total_time_ms)::numeric, 2) as avg_response_time,
  ROUND(AVG(confidence)::numeric, 3) as avg_confidence,
  COUNT(*) FILTER (WHERE results_count = 0) as fallback_count,
  ROUND(
    COUNT(*) FILTER (WHERE results_count = 0)::numeric / COUNT(*)::numeric * 100, 
    2
  ) as fallback_rate
FROM rag_logs
WHERE created_at >= NOW() - INTERVAL '24 hours'
GROUP BY DATE_TRUNC('hour', created_at)
ORDER BY hour DESC;
```

---

## ‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

1. **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - In-memory –∫—ç—à –¥–ª—è –ø–æ–∏—Å–∫–æ–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (5 –º–∏–Ω—É—Ç)
   - –ö—ç—à embeddings –≤ Supabase
   - –ö—ç—à –æ—Ç–≤–µ—Ç–æ–≤ GPT –¥–ª—è –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

2. **–ò–Ω–¥–µ–∫—Å—ã –ë–î** ‚úÖ –°–æ–∑–¥–∞–Ω—ã
   - IVFFlat –¥–ª—è –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - GIN –¥–ª—è –ø–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–∏—Å–∫–∞
   - –ò–Ω–¥–µ–∫—Å—ã –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã rag_logs

3. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ OpenAI
   - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase
   - Promise-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

4. **Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã** ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã
   - **–ü—Ä–∏ –æ—à–∏–±–∫–µ RPC** ‚Üí —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ (fallbackTextSearch) ‚Üí –±–æ—Ç –Ω–µ "–º–æ–ª—á–∏—Ç"
   - **–ü—Ä–∏ –æ—à–∏–±–∫–µ embedding** ‚Üí —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫ –ø–æ TSVector ‚Üí –≤—Å–µ–≥–¥–∞ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
   - **–ü—Ä–∏ –æ—à–∏–±–∫–µ GPT** ‚Üí –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º
   - **–ü—Ä–∏ —Ç–∞–π–º–∞—É—Ç–µ** ‚Üí —Ä–µ—Ç—Ä–∞–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –±—ç–∫–æ—Ñ—Ñ–æ–º ‚Üí –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å
   - **–ü—Ä–∏ –ø—É—Å—Ç—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö** ‚Üí —Å–Ω–∏–∂–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞ similarity ‚Üí –±–æ–ª—å—à–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –¢–∞–π–º–∞—É—Ç—ã –∏ —Ä–µ—Ç—Ä–∞–∏

```typescript
// –†–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ packages/backend/src/services/supabaseRAGService.ts
private readonly CACHE_TTL = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç
private readonly MAX_RETRIES = 3;
private readonly RETRY_DELAY = 1000; // 1 —Å–µ–∫—É–Ω–¥–∞

// –¢–∞–π–º–∞—É—Ç—ã –¥–ª—è fetchWithRetry
await this.fetchWithRetry(url, options, 20000); // Embeddings: 20 —Å–µ–∫
await this.fetchWithRetry(url, options, 30000); // GPT: 30 —Å–µ–∫
await this.fetchWithRetry(url, options, 10000); // Models: 10 —Å–µ–∫
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –±—ç–∫–æ—Ñ—Ñ–æ–º

---

## üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü—Ä–∏–º–µ—Ä 1: –ü—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
```python
# –í—Ö–æ–¥
question = "–ö–∞–∫ —Å–¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤?"

# –û–±—Ä–∞–±–æ—Ç–∫–∞
embedding = create_embedding(question)
results = hybrid_search(embedding, question, k=5)
answer = generate_answer(question, results)

# –í—ã—Ö–æ–¥
{
  "answer": "–î–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏...",
  "sources": [
    {
      "content": "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–ª–∏ API...",
      "score": 0.92
    }
  ],
  "confidence": 0.89
}
```

### –†–µ–∞–ª—å–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

**–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç**: "–ö–∞–∫–∏–µ –ª–∏–º–∏—Ç—ã –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤?"

**–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Å–∏—Å—Ç–µ–º–µ**:
1. **–°–æ–∑–¥–∞–Ω–∏–µ embedding** ‚Üí –≤–µ–∫—Ç–æ—Ä –∑–∞–ø—Ä–æ—Å–∞
2. **–ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫** ‚Üí –Ω–∞—Ö–æ–¥–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç—ã –ø—Ä–æ –ª–∏–º–∏—Ç—ã
3. **MMR –ø–µ—Ä–µ—Ä–∞–Ω–∂–∏—Ä–æ–≤–∞–Ω–∏–µ** ‚Üí –≤—ã–±–∏—Ä–∞–µ—Ç —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã
4. **GPT –≥–µ–Ω–µ—Ä–∞—Ü–∏—è** ‚Üí —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –æ—Ç–≤–µ—Ç —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏

**–†–µ–∑—É–ª—å—Ç–∞—Ç –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**:
```
üí≥ –õ–∏–º–∏—Ç—ã –Ω–∞ –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤:

‚Ä¢ –î–Ω–µ–≤–Ω–æ–π –ª–∏–º–∏—Ç: –¥–æ 100,000 —Ä—É–±–ª–µ–π
‚Ä¢ –ú–µ—Å—è—á–Ω—ã–π –ª–∏–º–∏—Ç: –¥–æ 1,000,000 —Ä—É–±–ª–µ–π  
‚Ä¢ –î–ª—è –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ª–∏–º–∏—Ç—ã –≤—ã—à–µ

üìö –ò—Å—Ç–æ—á–Ω–∏–∫–∏:
- –î–æ–∫—É–º–µ–Ω—Ç "–õ–∏–º–∏—Ç—ã –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è" (—Ä–∞–∑–¥–µ–ª 3.2)
- FAQ –ø–æ –≤—ã–≤–æ–¥—É —Å—Ä–µ–¥—Å—Ç–≤ (–≤–æ–ø—Ä–æ—Å 15)
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞**:
- ‚úÖ –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π
- ‚úÖ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏
- ‚úÖ Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏ –ª—é–±—ã—Ö –æ—à–∏–±–∫–∞—Ö
- ‚úÖ –ë—ã—Å—Ç—Ä—ã–π –æ—Ç–≤–µ—Ç (~2.2 —Å–µ–∫)

### –ü—Ä–∏–º–µ—Ä 2: –°–ª–æ–∂–Ω—ã–π –∑–∞–ø—Ä–æ—Å
```python
# –í—Ö–æ–¥
question = "–ö–∞–∫–∏–µ –µ—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—ã–≤–æ–¥—É —Å—Ä–µ–¥—Å—Ç–≤?"

# –û–±—Ä–∞–±–æ—Ç–∫–∞
# 1. –°–æ–∑–¥–∞–Ω–∏–µ embedding
# 2. –ì–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π + —Ç–µ–∫—Å—Ç–æ–≤—ã–π)
# 3. MMR –¥–ª—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
# 4. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞

# –í—ã—Ö–æ–¥
{
  "answer": "–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –≤—ã–≤–æ–¥—É —Å—Ä–µ–¥—Å—Ç–≤ –≤–∫–ª—é—á–∞—é—Ç:\n1. AML-–ø—Ä–æ–≤–µ—Ä–∫–∞...\n2. –õ–∏–º–∏—Ç—ã –ø–æ —Å—É–º–º–µ...",
  "sources": [
    {"content": "–û–±—ã—á–Ω–æ —ç—Ç–æ: AML-–ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å—Ö–æ–¥—è—â–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏...", "score": 0.88},
    {"content": "–õ–∏–º–∏—Ç—ã –ø–æ —Å—É–º–º–µ –∑–∞–≤–∏—Å—è—Ç –æ—Ç —É—Ä–æ–≤–Ω—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏...", "score": 0.85}
  ],
  "confidence": 0.87
}
```

---

## üéØ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### –ö–ª—é—á–µ–≤—ã–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è

‚úÖ **–í—ã—Å–æ–∫–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å** ‚Äî –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–∏—Å–∫ + MMR
‚úÖ **–ë—ã—Å—Ç—Ä–∞—è —Ä–∞–±–æ—Ç–∞** ‚Äî RPC + –∏–Ω–¥–µ–∫—Å—ã + –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ  
‚úÖ **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** ‚Äî fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã + —Ä–µ—Ç—Ä–∞–∏
‚úÖ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞
‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** ‚Äî –ø–æ–ª–Ω–∞—è –≤–∏–¥–∏–º–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–∏–∑ —Ä–µ–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤)

- **–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞**: ~2.2 —Å–µ–∫—É–Ω–¥—ã (–∏–∑–º–µ—Ä–∏–ª–∏ –≤ —Ç–µ—Å—Ç–∞—Ö)
- **–û–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤**: 50+ –∑–∞ –¥–µ–Ω—å (–∏–∑ rag_logs)
- **–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è**: 2206 –º—Å (–∏–∑ rag_stats)
- **Fallback rate**: 100% (–∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö –≤–µ–∫—Ç–æ—Ä–æ–≤ –≤ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–µ)
- **–£—Å–ø–µ—à–Ω–æ—Å—Ç—å API**: 100% (–≤—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏)

### –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Ä–∞–∑–≤–∏—Ç–∏—è

1. **–ú–Ω–æ–≥–æ—è–∑—ã—á–Ω–æ—Å—Ç—å** ‚Äî –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —è–∑—ã–∫–æ–≤
2. **–ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è** ‚Äî –∞–¥–∞–ø—Ç–∞—Ü–∏—è –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. **–û–±—É—á–µ–Ω–∏–µ** ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏
4. **–ê–Ω–∞–ª–∏—Ç–∏–∫–∞** ‚Äî –¥–µ—Ç–∞–ª—å–Ω–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—Ä–æ—Å–æ–≤

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏

**–¢–µ–∫—É—â–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**:
- In-memory –∫—ç—à –æ–≥—Ä–∞–Ω–∏—á–µ–Ω RAM —Å–µ—Ä–≤–µ—Ä–∞
- –û–¥–∏–Ω —ç–∫–∑–µ–º–ø–ª—è—Ä RAG —Å–µ—Ä–≤–∏—Å–∞
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ Supabase

**‚öôÔ∏è –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ —Ä–æ—Å—Ç–µ –Ω–∞–≥—Ä—É–∑–∫–∏ (1000+ –∑–∞–ø—Ä–æ—Å–æ–≤/—á–∞—Å)**:
- **Redis –∫—ç—à** ‚Üí —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ
- **Load balancer** ‚Üí –Ω–µ—Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ RAG
- **Connection pooling** ‚Üí –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- **Async queues** ‚Üí –æ—á–µ—Ä–µ–¥–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **CDN** ‚Üí –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö –æ—Ç–≤–µ—Ç–æ–≤

**‚öôÔ∏è –ü–ª–∞–Ω–∏—Ä—É–µ–º–æ–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**:
- –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- –û—Ç–¥–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã –¥–ª—è embedding –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ CPU/RAM

---

## üß™ –†–µ–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –¢–µ—Å—Ç RPC —Ñ—É–Ω–∫—Ü–∏–∏
```bash
‚úÖ RPC —Ñ—É–Ω–∫—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç!
üìä –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤: 1
üìã –¢–æ–ø —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
  1. Score: 0.700
     Cosine: 1.000
     Text: –î–∞. –ê–¥—Ä–µ—Å–∞, —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ API, –∑–∞–∫—Ä–µ–ø–ª—è—é—Ç—Å—è –∑–∞ –≤–∞—à–∏–º –∞–∫–∫–∞—É–Ω—Ç–æ–º...
```

### –¢–µ—Å—Ç API endpoint
```json
{
  "answer": "–î–ª—è –≤—ã–≤–æ–¥–∞ —Å—Ä–µ–¥—Å—Ç–≤ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏...",
  "sources": [
    {
      "content": "–í—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤ –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ –ª–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –∏–ª–∏ API...",
      "score": 0.85,
      "metadata": {
        "similarity": 0.92,
        "hybridScore": 0.85
      }
    }
  ],
  "confidence": 0.5,
  "searchTime": 124,
  "processingTime": 2234
}
```

### –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```json
{
  "total_queries": 50,
  "avg_search_time": 2205.2,
  "avg_llm_time": 0.32,
  "avg_total_time": 2206.06,
  "avg_confidence": 0.1,
  "fallback_rate": 100,
  "unique_questions": 8
}
```

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: `fallback_rate: 100%` —Å–≤—è–∑–∞–Ω —Å —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥–æ–π, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ç–µ—Å—Ç–æ–≤—ã–µ –≤–µ–∫—Ç–æ—Ä—ã –≤–º–µ—Å—Ç–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã—Ö embeddings –∏–∑ –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π.

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Supabase Vector Search](https://supabase.com/docs/guides/ai/vector-search)
- [OpenAI Embeddings](https://platform.openai.com/docs/guides/embeddings)
- [PostgreSQL pgvector](https://github.com/pgvector/pgvector)
- [RAG Best Practices](https://docs.llamaindex.ai/en/stable/getting_started/concepts.html)

---

*–°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π RAG –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã*
